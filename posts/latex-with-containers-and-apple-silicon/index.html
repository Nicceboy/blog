<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>LaTeX with OCI containers, Podman and Arch Linux ARM on Apple Silicon | A blog about computer systems</title><meta name=keywords content="containers,podman,docker,mac,arm,latex,oci"><meta name=description content="Building and using ARM-based OCI images on Apple Silicon from scratch. LaTeX document preparation system used as an example."><meta name=author content="Niklas Saari"><link rel=canonical href=https://nicce.dev/posts/latex-with-containers-and-apple-silicon/><link crossorigin=anonymous href=/assets/css/stylesheet.865dc8b4346904e1be19eb6cacac4babecea02cb4024d2d131421ceb5b2f24f0.css integrity="sha256-hl3ItDRpBOG+GetsrKxLq+zqAstAJNLRMUIc61svJPA=" rel="preload stylesheet" as=style><link rel=icon href=https://nicce.dev/images/binary.svg><link rel=icon type=image/png sizes=16x16 href=https://nicce.dev/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://nicce.dev/favicon-32x32.png><link rel=apple-touch-icon href=https://nicce.dev/images/binary.svg><link rel=mask-icon href=https://nicce.dev/images/binary.svg><meta name=theme-color content="#fff" media="(prefers-color-scheme: light)"><meta name=theme-color content="#1d1e20" media="(prefers-color-scheme: dark)"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=text/javascript async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script><script type=text/x-mathjax-config>
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[','\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});
</script><meta property="og:title" content="LaTeX with OCI containers, Podman and Arch Linux ARM on Apple Silicon"><meta property="og:description" content="Building and using ARM-based OCI images on Apple Silicon from scratch. LaTeX document preparation system used as an example."><meta property="og:type" content="article"><meta property="og:url" content="https://nicce.dev/posts/latex-with-containers-and-apple-silicon/"><meta property="og:image" content="https://nicce.dev/posts/latex-with-containers-and-apple-silicon/latex.svg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-02-11T00:00:00+00:00"><meta property="article:modified_time" content="2023-02-11T00:00:00+00:00"><meta property="og:site_name" content="Nicce's Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://nicce.dev/posts/latex-with-containers-and-apple-silicon/latex.svg"><meta name=twitter:title content="LaTeX with OCI containers, Podman and Arch Linux ARM on Apple Silicon"><meta name=twitter:description content="Building and using ARM-based OCI images on Apple Silicon from scratch. LaTeX document preparation system used as an example."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://nicce.dev/posts/"},{"@type":"ListItem","position":2,"name":"LaTeX with OCI containers, Podman and Arch Linux ARM on Apple Silicon","item":"https://nicce.dev/posts/latex-with-containers-and-apple-silicon/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"LaTeX with OCI containers, Podman and Arch Linux ARM on Apple Silicon","name":"LaTeX with OCI containers, Podman and Arch Linux ARM on Apple Silicon","description":"Building and using ARM-based OCI images on Apple Silicon from scratch. LaTeX document preparation system used as an example.","keywords":["containers","podman","docker","mac","arm","latex","oci"],"articleBody":"Since the release of Appleâ€™s M1 Chips, ARM architecture has expanded to a larger user base. The power efficiency and performance of the new chips have made them quite desirable. Unfortunately, most of the existing advanced developer-required toolchains were for x86_64 architecture in many cases.\nThis blog post introduces a brief overview of how to set up a container runner on your ARM Macbook and how to create an AArch64 Open Container Initiative (OCI) container image from the scratch.\nThe example builds $\\rm\\TeX$ Live for $\\rm\\LaTeX$ since I could not find an existing up-to-date image after I sold my soul to the devil by getting M2 Apple device.\nThere might be (there are) simpler ways to build LaTeX documents on your Macbook, but this gives us the most control in a reproducible environment!\nSelecting a container runner There are already quite many options to run OCI containers on ARM and MacOS. The obvious choice would be Docker Desktop on Mac, but we might not want yet-another Chromium instance to consume battery. We also like open-source software.\nAll of the current options are QEMU based since containers are based on the Linux kernel:\nColima as a minimal CLI-based daemon (containerd/dockerd) with Lima Finch is AWS backed and aims to bring a native client on MacOS for nerdctl and containerd with Lima. Includes core features and there is development to do. Podman (No daemon, based on libpod) Podman Desktop (GUI, no daemon, based on libpod) Rancher (GUI, containerd/dockerd and Lima) As noted, regardless of the selection, we need a VM instance to run our Linux kernel.\nAs daemonless and rootless option, in this blog, we use Buildah to build our images, and Podman to run them.\nPodman and Buildah Podman can be installed by using Homebrew or Nix. Podman can build OCI images from the Dockerfile. There is an advanced tool called Buildah, but unfortunately, Buildah cannot be directly used, as it is for Linux only. Some of the features will work on MacOS (if installed with Nix), but not all of them, and images will be separated from the Podman VM.\nPodman build command uses a subset of Buildah and it is sufficient for our needs for now; podman build is equivalent to buildah build -f Dockerfile Buildah can be used from the VM or inside another container, but that is too complicated for this post.\nInstalling Podman on Mac We will use Nix to install QEMU and Podman.\nnix-env -iA nixpkgs.qemu nixpkgs.podman Before anything works, we need to set up a virtual machine. At this point, it is important to note that you cannot mount folders into the containers unless you mount them into the VM too. So double mount is required; mount the folder into the VM, and mount the folder from VM into the container.\nYou could either mount a specific limited directory into the machine or the whole home directory, for example. Mounting the whole home directory might not be advised, but I will do it for demonstration purposes. CPU count and memory size has been also increased.\npodman machine init -m 4096 --cpus 2 -v \"$HOME:$HOME\" podman machine start podman info The final command should showcase that we are indeed running CoreOS on ARM instructions inside a VM:\nhost: arch: arm64 buildahVersion: 1.28.0 cgroupControllers: - cpu - io - memory - pids . . distribution: distribution: fedora variant: coreos version: \"37\" . . . Creating Arch Linux image from scratch Arch Linux has an excellent wiki and collection of up-to-date packages. For that reason, we install LaTeX on that distribution. However, there is no official container image for ARM-based Arch Linux.\nWe can create a base image from the scratch; we download the official AArch64 multiplatform release, and since Linux is purely a file-based system, we just import the contents into the container, and it should work.\ncurl -L http://os.archlinuxarm.org/os/ArchLinuxARM-aarch64-latest.tar.gz | podman import - archlinuxarm This will create a new image with the namespace localhost/archlinuxarm:latest.\nYou can try it out\npodman run --rm -it archlinuxarm bash $\\rm\\TeX$ Live image The constant change of indexes is a problem with the use of Arch Linux in containers. If the container base is not updated for a while, there will be conflicts. The release of packages requires PGP signatures, and new authors will bring new keys. Sometimes keys change or deprecate, too. The following image takes this into account and should be able to update its keyring automatically. For security reasons, this is often recommended to do manually, but we will trust Arch Linux maintainers and supply chain for now.\nSince we are going to build documents, the correct time might be important. We will make it possible to guarantee the correct timezone.\nWe might also want to install additional CTAN packages, which are not included in the Arch Linux repository. For that, we need The TeXLive Package Manager (tlmgr), which is often challenging to install. The following example installs EB Garamond font and setspace package.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 FROM archlinuxarm:latest # If you want to use custom mirror to download packages instead of the automatic geolocation # COPY mirrorlist /etc/pacman.d/mirrorlist # Define timezone for container ENV TZ=Europe/Helsinki RUN ln -snf \"/usr/share/zoneinfo/$TZ\" /etc/localtime \u0026\u0026 \\ echo \"$TZ\" \u003e /etc/timezone \u0026\u0026 \\ # If you are using BuildKIt instead of Buildah, see https://github.com/moby/buildkit/issues/1267 \\ # sed -i -e 's~#IgnorePkg.*~IgnorePkg = filesystem~g' '/etc/pacman.conf' \u0026\u0026 \\ # /etc/hosts and /etc/resolv.conf are read-only, filesystem package attempts to modify them pacman-key --init \u0026\u0026 pacman-key --populate archlinuxarm \u0026\u0026 \\ pacman-key --refresh-keys \u0026\u0026 \\ yes | pacman -Sy --noconfirm archlinux-keyring \u0026\u0026 \\ yes | pacman -Syyu --noconfirm \u0026\u0026 \\ pacman -S --noconfirm texlive-most \\ zsh \\ grml-zsh-config \\ wget \\ vim \\ # Reduce image size \\ \u0026\u0026 pacman -Sc --noconfirm \u0026\u0026 \\ rm -rf /var/cache/pacman/pkg/ \\ \u0026\u0026 usermod --shell /bin/zsh alarm ENV TLMGR /usr/share/texmf-dist/scripts/texlive/tlmgr.pl # For some reason, default tlmgr.pl contex filepath is in wrong location in Arch Linux RUN sed -i '/\\$Master = \"\\$Master\\/\\.\\.\\/\\.\\.\";/c \\$Master = \"\\${Master}\\/\\.\\.\\/\\.\\.\\/\\.\\.\";' $TLMGR USER alarm WORKDIR /home/alarm RUN echo \"alias tlmgr='${TLMGR} --usermode'\" \u003e\u003e /home/alarm/.zshrc \u0026\u0026 \\ ${TLMGR} --usermode -v init-usertree \u0026\u0026 ${TLMGR} --usermode install ebgaramond setspace ENTRYPOINT [\"/bin/zsh\"] Generated image will have the latest TeX Live distribution with a working package manager and desired default timezone. On runtime, the timezone can also be changed to -e TZ=Europe/Amsterdam with Podman parameter.\nIEEE Conference template as an example As an example, we will build IEEE Conference template. The template is provided in here.\nDownload and extract it:\ncurl -o ieee_template.zip -L https://www.ieee.org/content/dam/ieee-org/ieee/web/org/pubs/conference-latex-template_10-17-19.zip \u0026\u0026 7z x ieee_template.zip Mount the source into our container. Note the --userns option; it maps the ownership of the volume inside the container to the correct non-root user.\ncd Conference-LaTeX-template_10-17-19 podman run --userns=keep-id:uid=1000,gid=1000 --rm -itv \"$(pwd):/latex\" texlive:latest To build our document with LuaLatex and to also detect new changes\ncd /latex latexmk -pdflatex=lualatex -pdf -pvc conference_101719.tex And the PDF will finally appear in the mounted folder and will be rebuilt if the source is changed.\nConclusion Using Podman to build PDF files might be overly complicated, but it gives us a working and reproducible environment. LaTeX can be messy sometimes, and it is good to have a chance to roll back to the previous working environment version, which can be quickly removed as well.\n","wordCount":"1242","inLanguage":"en","image":"https://nicce.dev/posts/latex-with-containers-and-apple-silicon/latex.svg","datePublished":"2023-02-11T00:00:00Z","dateModified":"2023-02-11T00:00:00Z","author":{"@type":"Person","name":"Niklas Saari"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://nicce.dev/posts/latex-with-containers-and-apple-silicon/"},"publisher":{"@type":"Organization","name":"A blog about computer systems","logo":{"@type":"ImageObject","url":"https://nicce.dev/images/binary.svg"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://nicce.dev/ accesskey=h title="Home (Alt + H)"><img src=https://nicce.dev/images/binary.svg alt aria-label=logo height=25>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://nicce.dev/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://nicce.dev/tags/ title=Categories><span>Categories</span></a></li><li><a href=https://nicce.dev/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://nicce.dev/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>LaTeX with OCI containers, Podman and Arch Linux ARM on Apple Silicon</h1><div class=post-description>Building and using ARM-based OCI images on Apple Silicon from scratch. LaTeX document preparation system used as an example.</div><div class=post-meta><span title='2023-02-11 00:00:00 +0000 UTC'>February 11, 2023</span>&nbsp;Â·&nbsp;6 min&nbsp;Â·&nbsp;1242 words&nbsp;Â·&nbsp;Niklas Saari&nbsp;|&nbsp;<a href=https://github.com/Nicceboy/blog/tree/master/content/posts/latex-with-containers-and-apple-silicon/index.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><figure class=entry-cover><img loading=lazy src=https://nicce.dev/posts/latex-with-containers-and-apple-silicon/latex.svg alt="LaTeX logo"></figure><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#selecting-a-container-runner>Selecting a container runner</a></li><li><a href=#podman-and-buildah>Podman and Buildah</a></li><li><a href=#installing-podman-on-mac>Installing Podman on Mac</a></li><li><a href=#creating-arch-linux-image-from-scratch>Creating Arch Linux image from scratch</a></li><li><a href=#rmtex-live-image>$\rm\TeX$ Live image</a></li><li><a href=#ieee-conference-template-as-an-example>IEEE Conference template as an example</a></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div></details></div><div class=post-content><p>Since the release of Apple&rsquo;s M1 Chips, ARM architecture has expanded to a larger user base.
The power efficiency and performance of the new chips have made them quite desirable.
Unfortunately, most of the existing advanced developer-required toolchains were for x86_64 architecture in many cases.</p><p>This blog post introduces a brief overview of how to set up a container runner on your ARM Macbook and how to create an AArch64 <a href=https://opencontainers.org/about/overview/>Open Container Initiative (OCI)</a> container image from the scratch.</p><p>The example builds $\rm\TeX$ Live for $\rm\LaTeX$ since I could not find an existing up-to-date image after I sold my soul to the devil by getting M2 Apple device.</p><p>There <strong>might</strong> be (there are) simpler ways to build LaTeX documents on your Macbook, but this gives us the most control in a reproducible environment!</p><h2 id=selecting-a-container-runner>Selecting a container runner<a hidden class=anchor aria-hidden=true href=#selecting-a-container-runner>#</a></h2><p>There are already quite many options to run OCI containers on ARM and MacOS.
The obvious choice would be <a href=https://docs.docker.com/desktop/install/mac-install/><em>Docker Desktop on Mac</em></a>, but we might not want yet-another Chromium instance to consume battery.
We also like open-source software.</p><p>All of the current options are QEMU based since containers are based on the Linux kernel:</p><ul><li><a href=https://github.com/abiosoft/colima>Colima</a> as a minimal CLI-based daemon (containerd/dockerd) with <a href=https://github.com/lima-vm/lima>Lima</a></li><li><a href=https://github.com/runfinch/finch>Finch</a> is <a href=https://aws.amazon.com/blogs/opensource/introducing-finch-an-open-source-client-for-container-development/>AWS</a> backed and aims to bring a native client on MacOS for nerdctl and containerd with Lima. Includes core features and there is development to do.</li><li><a href=https://podman.io/getting-started/installation>Podman</a> (No daemon, based on libpod)</li><li><a href=https://podman-desktop.io/>Podman Desktop</a> (GUI, no daemon, based on libpod)</li><li><a href=https://rancherdesktop.io/>Rancher</a> (GUI, containerd/dockerd and Lima)</li></ul><p>As noted, regardless of the selection, we need a VM instance to run our Linux kernel.</p><p>As daemonless and rootless option, in this blog, we use Buildah to build our images, and Podman to run them.</p><h2 id=podman-and-buildah>Podman and Buildah<a hidden class=anchor aria-hidden=true href=#podman-and-buildah>#</a></h2><p>Podman can be installed by using <a href=https://formulae.brew.sh/formula/podman>Homebrew</a> or <a href=https://github.com/NixOS/nixpkgs/blob/master/pkgs/applications/virtualization/podman/default.nix>Nix</a>.
Podman can build OCI images from the <code>Dockerfile</code>.
There is an advanced tool called <a href=https://buildah.io/><em>Buildah</em></a>, but unfortunately, Buildah cannot be directly used, as it is for Linux only.
Some of the features will work on MacOS (if installed with Nix), but not all of them, and images will be separated from the Podman VM.</p><p>Podman <code>build</code> command uses a subset of Buildah and it is sufficient for our needs for now; <code>podman build</code> is equivalent to <code>buildah build -f Dockerfile</code>
Buildah can be used from the VM or inside another container, but that is too complicated for this post.</p><h2 id=installing-podman-on-mac>Installing Podman on Mac<a hidden class=anchor aria-hidden=true href=#installing-podman-on-mac>#</a></h2><p>We will use <a href=https://nixos.org/manual/nix/stable/package-management/basic-package-mgmt.html>Nix</a> to install QEMU and Podman.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>nix-env -iA nixpkgs.qemu nixpkgs.podman 
</span></span></code></pre></div><p>Before anything works, we need to set up a virtual machine.
At this point, it is important to note that you cannot mount folders into the containers unless you mount them into the VM too.
So double mount is required; mount the folder into the VM, and mount the folder from VM into the container.</p><p>You could either mount a specific limited directory into the machine or the whole home directory, for example.
Mounting the whole home directory might not be advised, but I will do it for demonstration purposes.
CPU count and memory size has been also increased.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>podman machine init -m <span class=m>4096</span> --cpus <span class=m>2</span> -v <span class=s2>&#34;</span><span class=nv>$HOME</span><span class=s2>:</span><span class=nv>$HOME</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>podman machine start
</span></span><span class=line><span class=cl>podman info
</span></span></code></pre></div><p>The final command should showcase that we are indeed running CoreOS on ARM instructions inside a VM:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>host:
</span></span><span class=line><span class=cl>  arch: arm64
</span></span><span class=line><span class=cl>  buildahVersion: 1.28.0
</span></span><span class=line><span class=cl>  cgroupControllers:
</span></span><span class=line><span class=cl>  - cpu
</span></span><span class=line><span class=cl>  - io
</span></span><span class=line><span class=cl>  - memory
</span></span><span class=line><span class=cl>  - pids
</span></span><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>  distribution:
</span></span><span class=line><span class=cl>    distribution: fedora
</span></span><span class=line><span class=cl>    variant: coreos
</span></span><span class=line><span class=cl>    version: <span class=s2>&#34;37&#34;</span>
</span></span><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>.
</span></span></code></pre></div><h2 id=creating-arch-linux-image-from-scratch>Creating Arch Linux image from scratch<a hidden class=anchor aria-hidden=true href=#creating-arch-linux-image-from-scratch>#</a></h2><p>Arch Linux has an excellent wiki and collection of up-to-date packages.
For that reason, we install LaTeX on that distribution.
However, there is no official container image for ARM-based Arch Linux.</p><p>We can create a base image from the scratch; we download the official AArch64 <a href=https://archlinuxarm.org/about/downloads>multiplatform release</a>, and since Linux is purely a file-based system, we just import the contents into the container, and it should work.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -L http://os.archlinuxarm.org/os/ArchLinuxARM-aarch64-latest.tar.gz <span class=p>|</span> podman import - archlinuxarm
</span></span></code></pre></div><p>This will create a new image with the namespace <code>localhost/archlinuxarm:latest</code>.</p><p>You can try it out</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>podman run --rm -it archlinuxarm bash
</span></span></code></pre></div><h2 id=rmtex-live-image>$\rm\TeX$ Live image<a hidden class=anchor aria-hidden=true href=#rmtex-live-image>#</a></h2><p>The constant change of indexes is a problem with the use of Arch Linux in containers.
If the container base is not updated for a while, there will be conflicts.
The release of packages requires PGP signatures, and new authors will bring new keys.
Sometimes keys change or deprecate, too.
The following image takes this into account and should be able to update its keyring automatically.
For security reasons, this is often recommended to do manually, but we will trust Arch Linux maintainers and supply chain for now.</p><p>Since we are going to build documents, the correct time might be important.
We will make it possible to guarantee the correct timezone.</p><p>We might also want to install additional <a href=https://ctan.org/>CTAN</a> packages, which are not included in the Arch Linux repository.
For that, we need The TeXLive Package Manager (tlmgr), which is often challenging to install.
The following example installs <em>EB Garamond font</em> and <em>setspace</em> package.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Dockerfile data-lang=Dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> archlinuxarm:latest</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># If you want to use custom mirror to download packages instead of the automatic geolocation</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># COPY mirrorlist /etc/pacman.d/mirrorlist</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Define timezone for container</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENV</span> <span class=nv>TZ</span><span class=o>=</span>Europe/Helsinki<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> ln -snf <span class=s2>&#34;/usr/share/zoneinfo/</span><span class=nv>$TZ</span><span class=s2>&#34;</span> /etc/localtime <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    <span class=nb>echo</span> <span class=s2>&#34;</span><span class=nv>$TZ</span><span class=s2>&#34;</span> &gt; /etc/timezone <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    <span class=c1># If you are using BuildKIt instead of Buildah, see https://github.com/moby/buildkit/issues/1267 \</span>
</span></span><span class=line><span class=cl>    <span class=c1># sed -i -e &#39;s~#IgnorePkg.*~IgnorePkg = filesystem~g&#39; &#39;/etc/pacman.conf&#39; &amp;&amp; \</span>
</span></span><span class=line><span class=cl>    <span class=c1># /etc/hosts and /etc/resolv.conf are read-only, filesystem package attempts to modify them</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>    pacman-key --init <span class=o>&amp;&amp;</span> pacman-key --populate archlinuxarm <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    pacman-key --refresh-keys <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    yes <span class=p>|</span> pacman -Sy --noconfirm archlinux-keyring <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    yes <span class=p>|</span> pacman -Syyu --noconfirm <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    pacman -S --noconfirm texlive-most <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    zsh <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    grml-zsh-config <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    wget <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    vim <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    <span class=c1># Reduce image size \</span>
</span></span><span class=line><span class=cl>    <span class=o>&amp;&amp;</span> pacman -Sc --noconfirm <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    rm -rf /var/cache/pacman/pkg/ <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    <span class=o>&amp;&amp;</span> usermod --shell /bin/zsh alarm<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENV</span> TLMGR /usr/share/texmf-dist/scripts/texlive/tlmgr.pl<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># For some reason, default tlmgr.pl contex filepath is in wrong location in Arch Linux </span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> sed -i <span class=s1>&#39;/\$Master = &#34;\$Master\/\.\.\/\.\.&#34;;/c     \$Master = &#34;\${Master}\/\.\.\/\.\.\/\.\.&#34;;&#39;</span> <span class=nv>$TLMGR</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>USER</span><span class=s> alarm</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>WORKDIR</span><span class=s> /home/alarm</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> <span class=nb>echo</span> <span class=s2>&#34;alias tlmgr=&#39;</span><span class=si>${</span><span class=nv>TLMGR</span><span class=si>}</span><span class=s2> --usermode&#39;&#34;</span> &gt;&gt; /home/alarm/.zshrc <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    <span class=si>${</span><span class=nv>TLMGR</span><span class=si>}</span> --usermode -v init-usertree <span class=o>&amp;&amp;</span> <span class=si>${</span><span class=nv>TLMGR</span><span class=si>}</span> --usermode install ebgaramond setspace<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENTRYPOINT</span> <span class=p>[</span><span class=s2>&#34;/bin/zsh&#34;</span><span class=p>]</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>Generated image will have the latest TeX Live distribution with a working package manager and desired default timezone.
On runtime, the timezone can also be changed to <code>-e TZ=Europe/Amsterdam</code> with Podman parameter.</p><h2 id=ieee-conference-template-as-an-example>IEEE Conference template as an example<a hidden class=anchor aria-hidden=true href=#ieee-conference-template-as-an-example>#</a></h2><p>As an example, we will build IEEE Conference template.
The template is provided <a href=https://www.ieee.org/conferences/publishing/templates.html>in here.</a></p><p>Download and extract it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -o ieee_template.zip -L https://www.ieee.org/content/dam/ieee-org/ieee/web/org/pubs/conference-latex-template_10-17-19.zip <span class=o>&amp;&amp;</span> 7z x ieee_template.zip
</span></span></code></pre></div><p>Mount the source into our container.
Note the <code>--userns</code> option; it maps the ownership of the volume inside the container to the correct non-root user.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> Conference-LaTeX-template_10-17-19 
</span></span><span class=line><span class=cl>podman run --userns<span class=o>=</span>keep-id:uid<span class=o>=</span>1000,gid<span class=o>=</span><span class=m>1000</span> --rm -itv <span class=s2>&#34;</span><span class=k>$(</span><span class=nb>pwd</span><span class=k>)</span><span class=s2>:/latex&#34;</span> texlive:latest
</span></span></code></pre></div><p>To build our document with LuaLatex and to also detect new changes</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> /latex
</span></span><span class=line><span class=cl>latexmk -pdflatex<span class=o>=</span>lualatex  -pdf -pvc conference_101719.tex
</span></span></code></pre></div><p>And the PDF will finally appear in the mounted folder and will be rebuilt if the source is changed.</p><h2 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h2><p>Using Podman to build PDF files might be overly complicated, but it gives us a working and reproducible environment.
LaTeX can be messy sometimes, and it is good to have a chance to roll back to the previous working environment version, which can be quickly removed as well.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://nicce.dev/tags/containers/>containers</a></li><li><a href=https://nicce.dev/tags/podman/>podman</a></li><li><a href=https://nicce.dev/tags/docker/>docker</a></li><li><a href=https://nicce.dev/tags/mac/>mac</a></li><li><a href=https://nicce.dev/tags/arm/>arm</a></li><li><a href=https://nicce.dev/tags/latex/>latex</a></li><li><a href=https://nicce.dev/tags/oci/>oci</a></li></ul><nav class=paginav><a class=next href=https://nicce.dev/posts/running-your-favorite-windows-games-on-linux-containers/><span class=title>Next Â»</span><br><span>Running Your Favorite Windows Games on Linux Containers</span></a></nav></footer></article></main><footer class=footer><span>Â© 2023 Niklas Saari</span>
<span></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>